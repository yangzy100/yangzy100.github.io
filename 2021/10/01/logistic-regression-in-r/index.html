<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Hugo 0.88.1" />


<title>Logistic Regression in R - Joey&#39;s Blogs</title>
<meta property="og:title" content="Logistic Regression in R - Joey&#39;s Blogs">


  <link href='/favicon.ico' rel='icon' type='image/x-icon'/>



  








<link href='//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css' rel='stylesheet' type='text/css' />



<link rel="stylesheet" href="/css/fonts.css" media="all">
<link rel="stylesheet" href="/css/main.css" media="all">



  </head>
  <body>
    <div class="wrapper">
      <header class="header">
        <nav class="nav">
  <a href="/" class="nav-logo">
    <img src="/images/logo.png"
         width="50"
         height="50"
         alt="Logo">
  </a>

  <ul class="nav-links">
    
    <li><a href="/about/">About</a></li>
    
    <li><a href="https://github.com/yangzy100">GitHub</a></li>
    
    <li><a href="https://www.linkedin.com/in/yangzy100/">Linkedin</a></li>
    
  </ul>
</nav>

      </header>


<main class="content" role="main">

  <article class="article">
    
    <span class="article-duration">4 min read</span>
    

    <h1 class="article-title">Logistic Regression in R</h1>

    
    <span class="article-date">2021-10-01</span>
    

    <div class="article-content">
      
<script src="/2021/10/01/logistic-regression-in-r/index_files/header-attrs/header-attrs.js"></script>


<pre class="r"><code># Load require library 
library(ISLR)
library(plyr)
library(tidyverse)  # data manipulation and visualization
library(modelr)     # provides easy pipeline modeling functions
library(broom)      # helps to tidy up model outputs
library(ROCR)       # ROC curve and AUC</code></pre>
<div id="read-in-data" class="section level2">
<h2>Read in Data</h2>
<pre class="r"><code># Load data 
(default &lt;- as_tibble(ISLR::Default))</code></pre>
<pre><code>## # A tibble: 10,000 x 4
##    default student balance income
##    &lt;fct&gt;   &lt;fct&gt;     &lt;dbl&gt;  &lt;dbl&gt;
##  1 No      No         730. 44362.
##  2 No      Yes        817. 12106.
##  3 No      No        1074. 31767.
##  4 No      No         529. 35704.
##  5 No      No         786. 38463.
##  6 No      Yes        920.  7492.
##  7 No      No         826. 24905.
##  8 No      Yes        809. 17600.
##  9 No      No        1161. 37469.
## 10 No      No           0  29275.
## # ... with 9,990 more rows</code></pre>
<pre class="r"><code># Check missing values for the data
sapply(default, function(x) sum(is.na(x))) </code></pre>
<pre><code>## default student balance  income 
##       0       0       0       0</code></pre>
<p>split our data into a training (60%) and testing (40%) data sets</p>
<pre class="r"><code>set.seed(123)
sample &lt;- sample(c(TRUE, FALSE), nrow(default), replace = T, prob = c(0.6,0.4))
train &lt;- default[sample, ]
test &lt;- default[!sample, ]</code></pre>
</div>
<div id="logistic-regression" class="section level2">
<h2>Logistic Regression</h2>
<pre class="r"><code>#Full model
full.glm&lt;-glm(default~., family=binomial, data=train)
summary(full.glm)</code></pre>
<pre><code>## 
## Call:
## glm(formula = default ~ ., family = binomial, data = train)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.4556  -0.1344  -0.0499  -0.0174   3.4155  
## 
## Coefficients:
##               Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -1.091e+01  6.481e-01 -16.830  &lt; 2e-16 ***
## studentYes  -8.095e-01  3.133e-01  -2.584  0.00978 ** 
## balance      5.907e-03  3.102e-04  19.040  &lt; 2e-16 ***
## income      -5.013e-06  1.079e-05  -0.465  0.64212    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 1723.03  on 6046  degrees of freedom
## Residual deviance:  895.02  on 6043  degrees of freedom
## AIC: 903.02
## 
## Number of Fisher Scoring iterations: 8</code></pre>
<p>we can see that income is not significant, drop it out in the model.</p>
<pre class="r"><code>#Final model
Final.glm&lt;-glm(default~.-income, family=binomial, data=train)
summary(Final.glm)</code></pre>
<pre><code>## 
## Call:
## glm(formula = default ~ . - income, family = binomial, data = train)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.4736  -0.1338  -0.0501  -0.0174   3.4114  
## 
## Coefficients:
##               Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -11.101501   0.499246 -22.237  &lt; 2e-16 ***
## studentYes   -0.694833   0.194184  -3.578 0.000346 ***
## balance       0.005902   0.000310  19.039  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 1723.03  on 6046  degrees of freedom
## Residual deviance:  895.23  on 6044  degrees of freedom
## AIC: 901.23
## 
## Number of Fisher Scoring iterations: 8</code></pre>
<p>plot the logistic regression fit line.</p>
<p>note that we need to convert our response variable to a [0,1] binary coded variable</p>
<pre class="r"><code># plot
default %&gt;%
  mutate(prob = ifelse(default == &quot;Yes&quot;, 1, 0)) %&gt;%
  ggplot(aes(balance, prob, fill=student)) +
  geom_point(alpha = .15) +
  geom_smooth(formula=&#39;y ~ x&#39;, method = &quot;glm&quot;, method.args = list(family = &quot;binomial&quot;)) +
  ggtitle(&quot;Logistic regression model fit for Student&quot;) +
  xlab(&quot;Balance&quot;) +
  ylab(&quot;Probability of Default&quot;)+
  theme_bw()+
  theme(legend.position = c(0.1,0.8))</code></pre>
<p><img src="/2021/10/01/logistic-regression-in-r/index_files/figure-html/unnamed-chunk-6-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>From the figure we can see that as the Balance increases, the probability of Default is increased. In addition, Non-student has higher probability of default.</p>
</div>
<div id="confusion-matrix" class="section level2">
<h2>confusion matrix</h2>
<p>Build the confusion matrix, a table of actual default classification against model prediction. Use a cutoff value of 0.5</p>
<pre class="r"><code>#Apply the fitted model to the test set. Print the confusion matrix and prediction accuracy.

# Get predictions
test_prob &lt;- predict(Final.glm, type = &quot;response&quot;, newdata = test)
test_pred &lt;- ifelse(test_prob &gt;= 0.5,&#39;Yes&#39;, &#39;No&#39;)

(test_tab=table(actuals=test$default, predicted=test_pred))</code></pre>
<pre><code>##        predicted
## actuals   No  Yes
##     No  3804   11
##     Yes  101   37</code></pre>
<pre class="r"><code>test_con_mat = caret::confusionMatrix(test_tab)

#prediction accuracy
c(test_con_mat$overall[&quot;Accuracy&quot;], 
  test_con_mat$byClass[&quot;Sensitivity&quot;], 
  test_con_mat$byClass[&quot;Specificity&quot;])</code></pre>
<pre><code>##    Accuracy Sensitivity Specificity 
##   0.9716671   0.9741357   0.7708333</code></pre>
</div>
<div id="roc-curve" class="section level2">
<h2>ROC curve</h2>
<pre class="r"><code>library(ROCR) 
# ROC curve
predROCR &lt;- prediction(test_prob, test$default)
perfROCR &lt;- performance(predROCR, &quot;tpr&quot;, &quot;fpr&quot;)
# Compute AUC
performance(predROCR, &quot;auc&quot;)@y.values[[1]]</code></pre>
<pre><code>## [1] 0.9421392</code></pre>
<pre class="r"><code>plot(perfROCR, colorize = TRUE)
abline(0,1,col=&#39;blue&#39;)
text(x=0.5,y=0.75, col=&#39;red&#39;,
     labels=paste(&#39;AUC =&#39;, round(performance(predROCR, &quot;auc&quot;)@y.values[[1]],4)))</code></pre>
<p><img src="/2021/10/01/logistic-regression-in-r/index_files/figure-html/unnamed-chunk-8-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>

    </div>
  </article>

  


</main>

      <footer class="footer">
        <ul class="footer-links">
          <li>
            <a href="/index.xml" type="application/rss+xml" target="_blank">RSS feed</a>
          </li>
          <li>
            <a href="https://gohugo.io/" class="footer-links-kudos">Made with <img src="/images/hugo-logo.png" alt="Img link to Hugo website" width="22" height="22"></a>
          </li>
        </ul>
      </footer>

    </div>
    



<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>



<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/r.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>



    
<script src="/js/math-code.js"></script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>


    
  </body>
</html>

