<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Hugo 0.88.1" />


<title>Logistic Regression in R - Joey&#39;s Blogs</title>
<meta property="og:title" content="Logistic Regression in R - Joey&#39;s Blogs">


  <link href='/favicon.ico' rel='icon' type='image/x-icon'/>



  








<link href='//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css' rel='stylesheet' type='text/css' />



<link rel="stylesheet" href="/css/fonts.css" media="all">
<link rel="stylesheet" href="/css/main.css" media="all">



  </head>
  <body>
    <div class="wrapper">
      <header class="header">
        <nav class="nav">
  <a href="/" class="nav-logo">
    <img src="/images/logo.png"
         width="50"
         height="50"
         alt="Logo">
  </a>

  <ul class="nav-links">
    
    <li><a href="/about/">About</a></li>
    
    <li><a href="https://github.com/yangzy100">GitHub</a></li>
    
    <li><a href="https://www.linkedin.com/in/yangzy100/">Linkedin</a></li>
    
  </ul>
</nav>

      </header>


<main class="content" role="main">

  <article class="article">
    
    <span class="article-duration">3 min read</span>
    

    <h1 class="article-title">Logistic Regression in R</h1>

    
    <span class="article-date">2021-10-01</span>
    

    <div class="article-content">
      
<script src="/2021/10/01/logistic-regression-in-r/index_files/header-attrs/header-attrs.js"></script>
<script src="/2021/10/01/logistic-regression-in-r/index_files/kePrint/kePrint.js"></script>
<link href="/2021/10/01/logistic-regression-in-r/index_files/lightable/lightable.css" rel="stylesheet" />


<pre class="r"><code># Load require library 
library(ISLR)
library(plyr)
library(tidyverse)  # data manipulation and visualization
library(modelr)     # provides easy pipeline modeling functions
library(broom)      # helps to tidy up model outputs
library(ROCR)       # ROC curve and AUC
library(kableExtra) # generating tables in HTML format</code></pre>
<div id="read-in-data" class="section level2">
<h2>Read in Data</h2>
<pre class="r"><code># Load data 
default &lt;- as_tibble(ISLR::Default)</code></pre>
<table class=" lightable-classic" style="font-family: Cambria; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
default
</th>
<th style="text-align:left;">
student
</th>
<th style="text-align:right;">
balance
</th>
<th style="text-align:right;">
income
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
No
</td>
<td style="text-align:left;">
No
</td>
<td style="text-align:right;">
729.5265
</td>
<td style="text-align:right;">
44361.625
</td>
</tr>
<tr>
<td style="text-align:left;">
No
</td>
<td style="text-align:left;">
Yes
</td>
<td style="text-align:right;">
817.1804
</td>
<td style="text-align:right;">
12106.135
</td>
</tr>
<tr>
<td style="text-align:left;">
No
</td>
<td style="text-align:left;">
No
</td>
<td style="text-align:right;">
1073.5492
</td>
<td style="text-align:right;">
31767.139
</td>
</tr>
<tr>
<td style="text-align:left;">
No
</td>
<td style="text-align:left;">
No
</td>
<td style="text-align:right;">
529.2506
</td>
<td style="text-align:right;">
35704.494
</td>
</tr>
<tr>
<td style="text-align:left;">
No
</td>
<td style="text-align:left;">
No
</td>
<td style="text-align:right;">
785.6559
</td>
<td style="text-align:right;">
38463.496
</td>
</tr>
<tr>
<td style="text-align:left;">
No
</td>
<td style="text-align:left;">
Yes
</td>
<td style="text-align:right;">
919.5885
</td>
<td style="text-align:right;">
7491.559
</td>
</tr>
</tbody>
</table>
<pre class="r"><code># Check missing values for the data
sapply(default, function(x) sum(is.na(x))) </code></pre>
<pre><code>## default student balance  income 
##       0       0       0       0</code></pre>
<p>split data into a training (60%) and testing (40%) data sets</p>
<pre class="r"><code>set.seed(123)
sample &lt;- sample(c(TRUE, FALSE), nrow(default), replace = T, prob = c(0.6,0.4))
train &lt;- default[sample, ]
test &lt;- default[!sample, ]</code></pre>
</div>
<div id="logistic-regression" class="section level2">
<h2>Logistic Regression</h2>
<pre class="r"><code>#Full model
full.glm&lt;-glm(default~., family=binomial, data=train)
summary(full.glm)$coefficients</code></pre>
<pre><code>##                  Estimate   Std. Error     z value     Pr(&gt;|z|)
## (Intercept) -1.090704e+01 6.480739e-01 -16.8299277 1.472817e-63
## studentYes  -8.094789e-01 3.133150e-01  -2.5835947 9.777661e-03
## balance      5.907134e-03 3.102425e-04  19.0403764 7.895817e-81
## income      -5.012701e-06 1.078617e-05  -0.4647343 6.421217e-01</code></pre>
<p>we can see that income is not significant, drop it out in the model.</p>
<pre class="r"><code>#Final model
Final.glm&lt;-glm(default~.-income, family=binomial, data=train)
summary(Final.glm)</code></pre>
<pre><code>## 
## Call:
## glm(formula = default ~ . - income, family = binomial, data = train)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.4736  -0.1338  -0.0501  -0.0174   3.4114  
## 
## Coefficients:
##               Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -11.101501   0.499246 -22.237  &lt; 2e-16 ***
## studentYes   -0.694833   0.194184  -3.578 0.000346 ***
## balance       0.005902   0.000310  19.039  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 1723.03  on 6046  degrees of freedom
## Residual deviance:  895.23  on 6044  degrees of freedom
## AIC: 901.23
## 
## Number of Fisher Scoring iterations: 8</code></pre>
<p>From the coefficients result we can see that both balance and student are statistically significant. In addition, The logistic regression coefficients give the change in the log odds of the outcome for a one unit increase in the predictor variable.</p>
<p>for every one unit change in balance, the log odds of default increase by 0.0059.
for student (vs non-student), changes the log odds of default by -0.6948.</p>
</div>
<div id="plot-the-logistic-regression-fit-line." class="section level2">
<h2>Plot the Logistic Regression Fit Line.</h2>
<p>note that we need to convert our response variable to a [0,1] binary coded variable</p>
<pre class="r"><code># plot
default %&gt;%
  mutate(prob = ifelse(default == &quot;Yes&quot;, 1, 0)) %&gt;%
  ggplot(aes(balance, prob, fill=student)) +
  geom_point(alpha = .15) +
  geom_smooth(formula=&#39;y ~ x&#39;, method = &quot;glm&quot;, method.args = list(family = &quot;binomial&quot;)) +
  ggtitle(&quot;Logistic Regression Model Fit&quot;) +
  xlab(&quot;Balance&quot;) +
  ylab(&quot;Probability of Default&quot;)+
  theme_bw()+
  theme(legend.position = c(0.1,0.8))</code></pre>
<p><img src="/2021/10/01/logistic-regression-in-r/index_files/figure-html/unnamed-chunk-7-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>From the figure we can see that as the Balance increases, the probability of Default is increased. In addition, Non-student has higher probability of default.</p>
</div>
<div id="confusion-matrix-and-prediction-accuracy" class="section level2">
<h2>Confusion Matrix and Prediction Accuracy</h2>
<p>Build the confusion matrix, a table of actual default classification against model prediction. Use a cutoff value of 0.5</p>
<pre class="r"><code>#Apply the fitted model to the test set. Print the confusion matrix and prediction accuracy.

# Get predictions
test_prob &lt;- predict(Final.glm, type = &quot;response&quot;, newdata = test)
test_pred &lt;- ifelse(test_prob &gt;= 0.5,&#39;Yes&#39;, &#39;No&#39;)

test_tab=table(actuals=test$default, predicted=test_pred)</code></pre>
<table class=" lightable-classic" style="font-family: Cambria; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="empty-cells: hide;" colspan="1">
</th>
<th style="padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #111111; margin-bottom: -1px; ">
Predicted
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
No
</th>
<th style="text-align:right;">
Yes
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
No
</td>
<td style="text-align:right;">
3804
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:left;">
Yes
</td>
<td style="text-align:right;">
101
</td>
<td style="text-align:right;">
37
</td>
</tr>
</tbody>
</table>
<pre class="r"><code>test_con_mat = caret::confusionMatrix(test_tab)</code></pre>
<table class=" lightable-classic" style="font-family: Cambria; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Result
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Accuracy
</td>
<td style="text-align:right;">
0.9716671
</td>
</tr>
<tr>
<td style="text-align:left;">
Sensitivity
</td>
<td style="text-align:right;">
0.9741357
</td>
</tr>
<tr>
<td style="text-align:left;">
Specificity
</td>
<td style="text-align:right;">
0.7708333
</td>
</tr>
</tbody>
</table>
</div>
<div id="roc-curve" class="section level2">
<h2>ROC curve</h2>
<pre class="r"><code>library(ROCR) 
# ROC curve
predROCR &lt;- prediction(test_prob, test$default)
perfROCR &lt;- performance(predROCR, &quot;tpr&quot;, &quot;fpr&quot;)
# Compute AUC
auc&lt;-performance(predROCR, &quot;auc&quot;)@y.values[[1]]

plot(perfROCR, colorize = TRUE)
abline(0,1,col=&#39;blue&#39;)
text(x=0.5,y=0.75, col=&#39;red&#39;,
     labels=paste(&#39;AUC =&#39;, round(auc,4)))</code></pre>
<p><img src="/2021/10/01/logistic-regression-in-r/index_files/figure-html/unnamed-chunk-12-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>The AUC (area under the curve) is 0.9421, which is close to 1, indicates that the model fit the data very well.</p>
</div>

    </div>
  </article>

  


</main>

      <footer class="footer">
        <ul class="footer-links">
          <li>
            <a href="/index.xml" type="application/rss+xml" target="_blank">RSS feed</a>
          </li>
          <li>
            <a href="https://gohugo.io/" class="footer-links-kudos">Made with <img src="/images/hugo-logo.png" alt="Img link to Hugo website" width="22" height="22"></a>
          </li>
        </ul>
      </footer>

    </div>
    



<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>



<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/r.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>



    
<script src="/js/math-code.js"></script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>


    
  </body>
</html>

