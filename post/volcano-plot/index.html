<!DOCTYPE html>
<html><head>
<title>Volcano plot</title>




<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="Create Volcano Plot from Raw data.">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">











<link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">


  






<link rel="stylesheet" href="/scss/journal.min.3f72a5fc8f5b5dd732a4b476aced0eece2156958d9d414316494ddb10593ddf7.css" integrity="sha256-P3Kl/I9bXdcypLR2rO0O7OIVaVjZ1BQxZJTdsQWT3fc=" media="screen">



<link rel="stylesheet" href="/scss/dark-mode.min.f7c2efa7183435a6bd1842f91c541481c7a5137b5991629a870f24e4a516ad4b.css" integrity="sha256-98Lvpxg0Naa9GEL5HFQUgcelE3tZkWKahw8k5KUWrUs=" media="screen">


<script src="/vendor/js/loadCSS.js"></script>
<script>
  loadCSS("https://fonts.googleapis.com/css?family=Fira+Mono|Material+Icons");
</script>






  <script src="/js/toc.js"></script>














</head>
<body>
    	<div id="app"><div id="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="/">
    
        <div class="nav-title">
            Joey&#39;s Blog
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
                
            
            
            
            <a class="a-block nav-link-item active" href="/post/">
                Posts
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/about/">
                About
            </a>
            
        
    </div>

    

    <div class="nav-footer">
        
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://amazingrise.net">Rise</a>
<br>
Ported from <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	2021 Joey&#39;s Blog
	

    </div>
    
</div><div id="extraContainer" class="extra-container">
    
    
    <div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }">


	<div class="toc-content">
	
		
		
		
		<center>- CATALOG -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%3ch2%3eVolcano%20plot%3c%2fh2%3e" onclick="onNavClick(`#&lt;h2&gt;Volcano plot&lt;/h2&gt;-nav`)" id="&lt;h2&gt;Volcano plot&lt;/h2&gt;-nav">
									Volcano plot
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%3ch2%3eLoad%20required%20R%20packages%3c%2fh2%3e" onclick="onNavClick(`#&lt;h2&gt;Load required R packages&lt;/h2&gt;-nav`)" id="&lt;h2&gt;Load required R packages&lt;/h2&gt;-nav">
									Load required R packages
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%3ch2%3eRead%20in%20data%3c%2fh2%3e" onclick="onNavClick(`#&lt;h2&gt;Read in data&lt;/h2&gt;-nav`)" id="&lt;h2&gt;Read in data&lt;/h2&gt;-nav">
									Read in data
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%3ch2%3eTranspose%20data%3c%2fh2%3e" onclick="onNavClick(`#&lt;h2&gt;Transpose data&lt;/h2&gt;-nav`)" id="&lt;h2&gt;Transpose data&lt;/h2&gt;-nav">
									Transpose data
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%3ch2%3eConvert%20data%20into%20numeric%3c%2fh2%3e" onclick="onNavClick(`#&lt;h2&gt;Convert data into numeric&lt;/h2&gt;-nav`)" id="&lt;h2&gt;Convert data into numeric&lt;/h2&gt;-nav">
									Convert data into numeric
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%3ch2%3eTransform%20the%20data%20into%20long%20format%3c%2fh2%3e" onclick="onNavClick(`#&lt;h2&gt;Transform the data into long format&lt;/h2&gt;-nav`)" id="&lt;h2&gt;Transform the data into long format&lt;/h2&gt;-nav">
									Transform the data into long format
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%3ch2%3eRun%20Multiple%20T-tests%3c%2fh2%3e" onclick="onNavClick(`#&lt;h2&gt;Run Multiple T-tests&lt;/h2&gt;-nav`)" id="&lt;h2&gt;Run Multiple T-tests&lt;/h2&gt;-nav">
									Run Multiple T-tests
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%3ch2%3eDistribution%20of%20p-values%3c%2fh2%3e" onclick="onNavClick(`#&lt;h2&gt;Distribution of p-values&lt;/h2&gt;-nav`)" id="&lt;h2&gt;Distribution of p-values&lt;/h2&gt;-nav">
									Distribution of p-values
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%3ch2%3eLog2%20transformation%20of%20the%20data%3c%2fh2%3e" onclick="onNavClick(`#&lt;h2&gt;Log2 transformation of the data&lt;/h2&gt;-nav`)" id="&lt;h2&gt;Log2 transformation of the data&lt;/h2&gt;-nav">
									Log2 transformation of the data
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%3ch2%3eVisualizing%20the%20results%3c%2fh2%3e" onclick="onNavClick(`#&lt;h2&gt;Visualizing the results&lt;/h2&gt;-nav`)" id="&lt;h2&gt;Visualizing the results&lt;/h2&gt;-nav">
									Visualizing the results
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
    
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top" :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a type="button" class="pagination-action" id="darkModeToggleButton">
            <span class="material-icons pagination-action-icon" id="darkModeToggleIcon">
                dark_mode
            </span>
        </a>
        
        
    </div>
</div>
<div class="single-column-drawer-container" id="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                    
                
                
                
                <a class="a-block drawer-menu-item active" href="/post/">
                    Posts
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/about/">
                    About
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- CATALOG -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%3ch2%3eVolcano%20plot%3c%2fh2%3e" onclick="onNavClick(`#&lt;h2&gt;Volcano plot&lt;/h2&gt;-nav`)" id="&lt;h2&gt;Volcano plot&lt;/h2&gt;-nav">
									Volcano plot
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%3ch2%3eLoad%20required%20R%20packages%3c%2fh2%3e" onclick="onNavClick(`#&lt;h2&gt;Load required R packages&lt;/h2&gt;-nav`)" id="&lt;h2&gt;Load required R packages&lt;/h2&gt;-nav">
									Load required R packages
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%3ch2%3eRead%20in%20data%3c%2fh2%3e" onclick="onNavClick(`#&lt;h2&gt;Read in data&lt;/h2&gt;-nav`)" id="&lt;h2&gt;Read in data&lt;/h2&gt;-nav">
									Read in data
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%3ch2%3eTranspose%20data%3c%2fh2%3e" onclick="onNavClick(`#&lt;h2&gt;Transpose data&lt;/h2&gt;-nav`)" id="&lt;h2&gt;Transpose data&lt;/h2&gt;-nav">
									Transpose data
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%3ch2%3eConvert%20data%20into%20numeric%3c%2fh2%3e" onclick="onNavClick(`#&lt;h2&gt;Convert data into numeric&lt;/h2&gt;-nav`)" id="&lt;h2&gt;Convert data into numeric&lt;/h2&gt;-nav">
									Convert data into numeric
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%3ch2%3eTransform%20the%20data%20into%20long%20format%3c%2fh2%3e" onclick="onNavClick(`#&lt;h2&gt;Transform the data into long format&lt;/h2&gt;-nav`)" id="&lt;h2&gt;Transform the data into long format&lt;/h2&gt;-nav">
									Transform the data into long format
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%3ch2%3eRun%20Multiple%20T-tests%3c%2fh2%3e" onclick="onNavClick(`#&lt;h2&gt;Run Multiple T-tests&lt;/h2&gt;-nav`)" id="&lt;h2&gt;Run Multiple T-tests&lt;/h2&gt;-nav">
									Run Multiple T-tests
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%3ch2%3eDistribution%20of%20p-values%3c%2fh2%3e" onclick="onNavClick(`#&lt;h2&gt;Distribution of p-values&lt;/h2&gt;-nav`)" id="&lt;h2&gt;Distribution of p-values&lt;/h2&gt;-nav">
									Distribution of p-values
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%3ch2%3eLog2%20transformation%20of%20the%20data%3c%2fh2%3e" onclick="onNavClick(`#&lt;h2&gt;Log2 transformation of the data&lt;/h2&gt;-nav`)" id="&lt;h2&gt;Log2 transformation of the data&lt;/h2&gt;-nav">
									Log2 transformation of the data
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%3ch2%3eVisualizing%20the%20results%3c%2fh2%3e" onclick="onNavClick(`#&lt;h2&gt;Visualizing the results&lt;/h2&gt;-nav`)" id="&lt;h2&gt;Visualizing the results&lt;/h2&gt;-nav">
									Visualizing the results
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div id="drawer-mask" v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav id="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div id="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a id="navTitle" class="navbar-brand" href="/">
            Joey&#39;s Blog
        </a>
        
        <button type="button" class="nav-darkmode-toggle" id="darkModeToggleButton2">
            <i class="material-icons" id="darkModeToggleIcon2">
                dark_mode
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" id="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="/">
        <div class="single-column-header-title">Joey&#39;s Blog</div>
        

    </a>
</div>

            <div id="content">
                <div id="streamContainer" class="stream-container">

    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            
                
            

            <div class="post-head-wrapper"
                
                    
                    
                    style="background-image: url('/images/volcano.png')"
                    
                
            >
                <div class="post-title">
                    Volcano plot
                    
                    <div class="post-subtitle">
                        Create Volcano Plot from Raw data.
                    </div>
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2021-11-30 00:00
                        </time>
                        

                        
                            <i class="material-icons" style="">folder</i>
                                <a href="/categories/">[R]</a>
                                &nbsp;
                        

                        
                            <i class="material-icons" style="">label</i>
                            
                                <a href="/tags/plot">plot</a>
                                &nbsp;
                            
                        
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                
                <div class="post-body" v-pre>
                
                    
<script src="/post/volcano-plot/index_files/header-attrs/header-attrs.js"></script>


<div id="volcano-plot" class="section level2">
<h2>Volcano plot</h2>
<p>Volcano plots are commonly used to display the results of bio experiments. A volcano plot is a type of scatter plot that shows statistical significance (P value) versus magnitude of change (fold change). It enables quick visual identification of genes with large fold changes that are also statistically significant. These may be the most biologically significant genes. In a volcano plot, the most upregulated genes are towards the right, the most downregulated genes are towards the left, and the most statistically significant genes are towards the top.</p>
<p>Here we will show how to start from data set to the final volcano plot.</p>
</div>
<div id="load-required-r-packages" class="section level2">
<h2>Load required R packages</h2>
<pre class="r"><code>library(dplyr)
library(tidyverse)
library(rstatix)
library(ggplot2)
library(ggrepel)
library(ggpubr)
library(EnhancedVolcano)</code></pre>
</div>
<div id="read-in-data" class="section level2">
<h2>Read in data</h2>
<p>the example data was download from <a href="https://dev.networkanalyst.ca/resources/data/test/E-GEOD-25713.txt">here</a>.</p>
<pre class="r"><code>raw.data&lt;-read.table(&quot;E-GEOD-25713.txt&quot;, header = T)
head(raw.data[,1:5])</code></pre>
<pre><code>##     NAME    GSM631514   GSM631515    GSM631516   GSM631517
## 1  CLASS      CONTROL     CONTROL      CONTROL     CONTROL
## 2 218581  0.001585484 -0.05552578 -0.002326012 0.053940773
## 3 630499  0.067639825    0.129704 -0.023203375  -0.1973443
## 4  17474  -0.19309902  0.17437744   0.20546722  0.01872158
## 5  72590  0.026670456 0.059513092 -0.010932922 -0.08618355
## 6  74616 -0.007469177    0.127182   0.27496672 -0.11971235</code></pre>
<p>the data set includes about 5000 genes from a meta-analysis of helminth infections in mouse liver.</p>
<pre><code>## [1] 4999   25</code></pre>
</div>
<div id="transpose-data" class="section level2">
<h2>Transpose data</h2>
<pre class="r"><code>data&lt;-as.data.frame(t(raw.data[,-1]))
colnames(data)&lt;-raw.data[,1]
head(data[,1:5])</code></pre>
<pre><code>##             CLASS       218581       630499       17474        72590
## GSM631514 CONTROL  0.001585484  0.067639825 -0.19309902  0.026670456
## GSM631515 CONTROL  -0.05552578     0.129704  0.17437744  0.059513092
## GSM631516 CONTROL -0.002326012 -0.023203375  0.20546722 -0.010932922
## GSM631517 CONTROL  0.053940773   -0.1973443  0.01872158  -0.08618355
## GSM631518 CONTROL  0.013415813 -0.102094175  0.03093195  -0.09370041
## GSM631519 CONTROL -0.011088848  0.125297069 -0.23639917   0.10463333</code></pre>
</div>
<div id="convert-data-into-numeric" class="section level2">
<h2>Convert data into numeric</h2>
<pre class="r"><code>for (i in 2:ncol(data)) {
  data[,i]&lt;-as.numeric(data[,i])
}

head(data[,1:5])</code></pre>
<pre><code>##             CLASS       218581      630499       17474       72590
## GSM631514 CONTROL  0.001585484  0.06763983 -0.19309902  0.02667046
## GSM631515 CONTROL -0.055525780  0.12970400  0.17437744  0.05951309
## GSM631516 CONTROL -0.002326012 -0.02320337  0.20546722 -0.01093292
## GSM631517 CONTROL  0.053940773 -0.19734430  0.01872158 -0.08618355
## GSM631518 CONTROL  0.013415813 -0.10209417  0.03093195 -0.09370041
## GSM631519 CONTROL -0.011088848  0.12529707 -0.23639917  0.10463333</code></pre>
<pre class="r"><code>summary(data[,1:4])</code></pre>
<pre><code>##     CLASS               218581             630499             17474        
##  Length:24          Min.   :-0.05553   Min.   :-0.19734   Min.   :-0.2364  
##  Class :character   1st Qu.: 0.04381   1st Qu.: 0.05872   1st Qu.: 0.1165  
##  Mode  :character   Median : 0.59891   Median : 0.17796   Median : 0.9374  
##                     Mean   : 0.80345   Mean   : 0.28054   Mean   : 1.3054  
##                     3rd Qu.: 1.40260   3rd Qu.: 0.55904   3rd Qu.: 2.2361  
##                     Max.   : 2.39095   Max.   : 1.11271   Max.   : 3.5559</code></pre>
<p>Since the values in a large range, we need to normalize the data (0 to 1) first.</p>
<pre class="r"><code>#data.n&lt;-data 
data.n&lt;-apply(data[,-1], 2, function(x) {(x - min(x, na.rm = T))/(max(x, na.rm = T) - min(x, na.rm = T))})
data.n&lt;-as.data.frame(cbind(data[,1], data.n))
for (i in 2:ncol(data.n)) {
  data.n[,i]&lt;-as.numeric(data.n[,i])
}
names(data.n)[1]&lt;-&quot;CLASS&quot;
head(data.n[,1:5])</code></pre>
<pre><code>##             CLASS     218581     630499      17474       72590
## GSM631514 CONTROL 0.02334433 0.20226950 0.01141786 0.139117537
## GSM631515 CONTROL 0.00000000 0.24964476 0.10831813 0.177075116
## GSM631516 CONTROL 0.02174550 0.13292645 0.11651622 0.095657774
## GSM631517 CONTROL 0.04474465 0.00000000 0.06727306 0.008687543
## GSM631518 CONTROL 0.02818000 0.07270698 0.07049283 0.000000000
## GSM631519 CONTROL 0.01816367 0.24628083 0.00000000 0.229222422</code></pre>
<p>Check the range of data to make sure it is from 0 to 1.</p>
<pre class="r"><code>summary(data.n[,1:4])</code></pre>
<pre><code>##     CLASS               218581           630499           17474        
##  Length:24          Min.   :0.0000   Min.   :0.0000   Min.   :0.00000  
##  Class :character   1st Qu.:0.0406   1st Qu.:0.1955   1st Qu.:0.09307  
##  Mode  :character   Median :0.2675   Median :0.2865   Median :0.30952  
##                     Mean   :0.3511   Mean   :0.3648   Mean   :0.40655  
##                     3rd Qu.:0.5960   3rd Qu.:0.5774   3rd Qu.:0.65198  
##                     Max.   :1.0000   Max.   :1.0000   Max.   :1.00000</code></pre>
</div>
<div id="transform-the-data-into-long-format" class="section level2">
<h2>Transform the data into long format</h2>
<p>Put all variables in the same column except the grouping variable</p>
<pre class="r"><code>data.long &lt;- data.n %&gt;%
  pivot_longer(-CLASS, names_to = &quot;variables&quot;, values_to = &quot;value&quot;)
data.long$value&lt;-as.numeric(data.long$value)
data.long %&gt;% sample_n(6)</code></pre>
<pre><code>## # A tibble: 6 x 3
##   CLASS    variables value
##   &lt;chr&gt;    &lt;chr&gt;     &lt;dbl&gt;
## 1 CONTROL  215031    0.485
## 2 INFECTED 72607     0.389
## 3 INFECTED 232086    0.757
## 4 INFECTED 14694     0.756
## 5 INFECTED 227298    0.642
## 6 INFECTED 70266     0.596</code></pre>
</div>
<div id="run-multiple-t-tests" class="section level2">
<h2>Run Multiple T-tests</h2>
<p>Group the data by variables and compare groups
Adjust the p-values and add significance levels</p>
<pre class="r"><code>stat.test &lt;- data.long %&gt;%
  group_by(variables) %&gt;%
  t_test(value ~ CLASS) %&gt;%
  adjust_pvalue(method = &quot;fdr&quot;) %&gt;%
  add_significance()
head(stat.test)</code></pre>
<pre><code>## # A tibble: 6 x 11
##   variables .y.   group1  group2      n1    n2 statistic    df         p   p.adj
##   &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;    &lt;int&gt; &lt;int&gt;     &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
## 1 100034251 value CONTROL INFECTED     6    18    -6.75  11.9  0.0000208 7.72e-5
## 2 100034361 value CONTROL INFECTED     6    18    -0.804 18.4  0.431     4.83e-1
## 3 100038882 value CONTROL INFECTED     6    18    -0.746 21.9  0.464     5.15e-1
## 4 100087    value CONTROL INFECTED     6    18    -1.27   7.86 0.241     2.90e-1
## 5 100088    value CONTROL INFECTED     6    18    -4.19  14.9  0.00079   1.68e-3
## 6 100102    value CONTROL INFECTED     6    18    -2.34  21.8  0.0287    4.20e-2
## # ... with 1 more variable: p.adj.signif &lt;chr&gt;</code></pre>
<pre><code>## [1] 4998   11</code></pre>
</div>
<div id="distribution-of-p-values" class="section level2">
<h2>Distribution of p-values</h2>
<p>Plot a histogram of the p-values.</p>
<p><img src="/post/volcano-plot/index_files/figure-html/hist.p-1.png" width="672" /></p>
</div>
<div id="log2-transformation-of-the-data" class="section level2">
<h2>Log2 transformation of the data</h2>
<pre class="r"><code>data.long.log &lt;- data.long
data.long.log$value &lt;- log2(data.long$value+0.01) 
head(data.long.log)</code></pre>
<pre><code>## # A tibble: 6 x 3
##   CLASS   variables  value
##   &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt;
## 1 CONTROL 218581    -4.91 
## 2 CONTROL 630499    -2.24 
## 3 CONTROL 17474     -5.55 
## 4 CONTROL 72590     -2.75 
## 5 CONTROL 74616     -0.577
## 6 CONTROL 93695     -2.99</code></pre>
<p>Calculate the mean of Gene for each group</p>
<pre class="r"><code>data.long.log %&gt;%
  group_by(CLASS, variables) %&gt;%
  summarise_at(vars(value), list(mean = ~mean(., na.rm=TRUE))) -&gt; data.long.mean
head(data.long.mean)</code></pre>
<pre><code>## # A tibble: 6 x 3
## # Groups:   CLASS [1]
##   CLASS   variables   mean
##   &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt;
## 1 CONTROL 100034251 -2.65 
## 2 CONTROL 100034361 -0.511
## 3 CONTROL 100038882 -1.59 
## 4 CONTROL 100087    -1.99 
## 5 CONTROL 100088    -2.83 
## 6 CONTROL 100102    -1.84</code></pre>
<pre class="r"><code>#summary(data.long.mean)</code></pre>
<p>because our data is already log2 transformed, we can take the difference between the means.
And this is our log2 Fold Change or log2 Ratio == log2(control / infected)</p>
<pre class="r"><code>data.long.mean.CONTROL&lt;-data.long.mean %&gt;% filter(CLASS==&#39;CONTROL&#39;)
data.long.mean.INFECTED&lt;-data.long.mean %&gt;% filter(CLASS==&#39;INFECTED&#39;)

log2FoldChange &lt;- data.frame(data.long.mean.CONTROL$mean - data.long.mean.INFECTED$mean)
colnames(log2FoldChange)[1]&lt;-&quot;log2FoldChange&quot;
head(log2FoldChange)</code></pre>
<pre><code>##   log2FoldChange
## 1     -2.1225768
## 2      0.1617805
## 3      0.2549574
## 4     -0.7523531
## 5     -1.8459492
## 6     -0.2931409</code></pre>
<pre class="r"><code>results = cbind(log2FoldChange$log2FoldChange, stat.test$p.adj)
results = as.data.frame(results)
colnames(results)[1]&lt;-&quot;log2FoldChange&quot;
colnames(results)[2]&lt;-&quot;FDR&quot;
rownames(results) &lt;- stat.test$variables
results$Log10FDR &lt;- -1*log10(results$FDR)
#results$Log10pValue &lt;- -1*log10(results$pValue)

head(results)</code></pre>
<pre><code>##           log2FoldChange          FDR  Log10FDR
## 100034251     -2.1225768 7.717773e-05 4.1125080
## 100034361      0.1617805 4.833157e-01 0.3157691
## 100038882      0.2549574 5.153493e-01 0.2878983
## 100087        -0.7523531 2.899658e-01 0.5376532
## 100088        -1.8459492 1.680894e-03 2.7744597
## 100102        -0.2931409 4.196682e-02 1.3770939</code></pre>
<pre class="r"><code>### Set thresholds
padj.cutoff &lt;- 0.05
lfc.cutoff &lt;- 0.58

#The fc cutoff is set to 0.58; remember that we are working with log2 fold changes
#so this translates to an actual fold change of 1.5 which is pretty reasonable.

threshold &lt;- results$FDR &lt; padj.cutoff &amp; abs(results$log2FoldChange) &gt; lfc.cutoff

length(which(threshold)) #1672</code></pre>
<pre><code>## [1] 3319</code></pre>
<pre class="r"><code>results$threshold&lt;-threshold</code></pre>
<p>Now we can easily subset the results table to only include those
that are significant using the subset() function:</p>
<pre class="r"><code>sigOE &lt;- data.frame(subset(results, threshold==TRUE))</code></pre>
<p>show the top 10 genes with lowest p-value</p>
<pre class="r"><code>results_ordered &lt;- results[order(results$FDR), ] 

results_ordered$genelabels &lt;- rownames(results_ordered) %in% rownames(results_ordered[1:10,])

(results_ordered[1:15,])</code></pre>
<pre><code>##        log2FoldChange          FDR Log10FDR threshold genelabels
## 14998       -4.308052 4.798080e-10 9.318933      TRUE       TRUE
## 23833       -3.579200 4.798080e-10 9.318933      TRUE       TRUE
## 26362       -3.188878 4.798080e-10 9.318933      TRUE       TRUE
## 98267       -4.401332 4.798080e-10 9.318933      TRUE       TRUE
## 105855      -4.144539 6.164200e-10 9.210123      TRUE       TRUE
## 12262       -3.337432 6.164200e-10 9.210123      TRUE       TRUE
## 12362       -3.436041 6.164200e-10 9.210123      TRUE       TRUE
## 20210       -3.788854 6.164200e-10 9.210123      TRUE       TRUE
## 22329       -3.940544 6.164200e-10 9.210123      TRUE       TRUE
## 24088       -3.529913 6.164200e-10 9.210123      TRUE       TRUE
## 65221       -3.214735 6.164200e-10 9.210123      TRUE      FALSE
## 71712       -4.229248 6.164200e-10 9.210123      TRUE      FALSE
## 16792       -3.542597 6.920308e-10 9.159875      TRUE      FALSE
## 17084       -3.494328 9.746100e-10 9.011169      TRUE      FALSE
## 18173       -3.358720 1.239504e-09 8.906752      TRUE      FALSE</code></pre>
</div>
<div id="visualizing-the-results" class="section level2">
<h2>Visualizing the results</h2>
<pre class="r"><code>EnhancedVolcano(results,
                lab = rownames(results),
                x = &quot;log2FoldChange&quot;,
                y = &quot;FDR&quot;,
                pCutoff = 0.05,  #The default P value cut-off of 10e-6
                FCcutoff = 0.58, #The default cut-off for log2FC is &gt;|2|
                xlim = c(-5, 5),
                ylim = c(0, 10),
                xlab = bquote(&quot;Difference,&quot; ~Log[2] ~ &quot;fold change (Control vs. Infected)&quot;),
                ylab = bquote(~-Log[10] ~ italic(p) ~ &quot;-Value (FDR adjusted)&quot;),
                title = &quot;Control versus Infected&quot;,
                subtitle = &#39;Differential expression&#39;)</code></pre>
<pre><code>## Warning: Ignoring unknown parameters: xlim, ylim</code></pre>
<p><img src="/post/volcano-plot/index_files/figure-html/fig1-1.png" width="768" style="display: block; margin: auto;" /></p>
</div>

                    
                    <HR width="100%" id="EOF">
		    <p style="color:#777;">Last modified on 2021-11-30</p>
                    
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts">
			Next<br>No newer posts.
                </a>
                
                
                
                <a class="older-posts" href="/post/logistic-regression-in-r/">
			Previous<br>Logistic Regression in R
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                










            </div>
        </div>
    </div>


                    </div>
            </div><div id="single-column-footer">
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://amazingrise.net">Rise</a>
<br>
Ported from <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	2021 Joey&#39;s Blog
	
</div>
            </div>
    
    <script src="/js/journal.js"></script>
    </body>
</html>
